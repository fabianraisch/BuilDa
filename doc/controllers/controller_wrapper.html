<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>src.controllers.controller_wrapper API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>src.controllers.controller_wrapper</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="src.controllers.controller_wrapper.ControllerWrapper"><code class="flex name class">
<span>class <span class="ident">ControllerWrapper</span></span>
<span>(</span><span>controller_names: List[str],<br>controller_step_size: int,<br>fmu_wrapper: <a title="src.fmuwrapper.FMUWrapper" href="../fmuwrapper.html#src.fmuwrapper.FMUWrapper">FMUWrapper</a>)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ControllerWrapper:
    &#39;&#39;&#39;
    This class provides functions to handle:

    - Controller configuration
    - Decision-making regarding whether a control action should be performed at the current time step
    - Information gathering about the variables needed from the FMU for the control actions
    - The control actions themselves

    The controller wrapper object acts as an interface between the controller classes and the simulation loop.
    &#39;&#39;&#39;
    def __init__(self, 
                 controller_names: List[str],
                 controller_step_size: int,
                 fmu_wrapper: FMUWrapper):


        #%%instantiation of controllers
        self.controllers=list()
        b_internal_heating_controller_active=bool(list(fmu_wrapper.get_fmu_state_dict([&#34;UseInternalController.k&#34;]).values())[0])
        for controller_name in controller_names:
            controller=get_controller_by_string(controller_name)
            # if model internal heating controller should be used, don&#39;t add external heating controllers to list. 
            # criterion to be an external heating controller: output is &#39;ctrSignalHeating&#39; (heating controller interface of fmu)
            if not(b_internal_heating_controller_active and &#34;ctrSignalHeating&#34; in controller.parameters_u):
                self.controllers.append(controller)
        
        #%%
        self.controller_step_size = controller_step_size

        self.fmu_wrapper = fmu_wrapper

    def configure_controllers(self):
        &#39;&#39;&#39;
        Configure external controller instances for the current simulation series.

        This method iterates through the list of previously instantiated external 
        controller class instances and configures each one using the current 
        state of the FMU. The configuration is done by retrieving the control 
        variables specific to each controller.

        &#39;&#39;&#39;        
        for controller in self.controllers:
                controller.configure(self.fmu_wrapper.get_fmu_state_dict(controller.get_control_variables()))

    def perform_control_check(self, curr_time_relative):
        &#39;&#39;&#39;
        Determines if control action should be performed at the current simulation time.
        Returns a boolean indicating whether the the control action should be performed based on the elapsed simulation time and the `controller_step_size` parameter from the configuration.

        Parameters:
            curr_time_relative (float): The simulation time, elapsed since simulation start time

        Returns:
            bool: True if control action should be performed, False otherwise.
        &#39;&#39;&#39; 
        if any(self.controllers) and curr_time_relative % self.controller_step_size == 0:
            return True
        else:
            return False

    def get_variables_to_read(self):
        &#39;&#39;&#39;
        Retrieve all variables from the model needed for calculating control outputs.

        This method collects and returns a list of variables required by the 
        external controllers to compute their respective control outputs.
        &#39;&#39;&#39;        
        variables_to_read = []
        for controller in self.controllers:   
            variables_to_read+=controller.get_control_variables() # Read all the controller variables when controller step is needed.
        return variables_to_read

    def handle_control_action(self, curr_time, fmu_state_dict):
        &#39;&#39;&#39;
        Handle control action(s) by iterating through the external controllers in use, 
        calculating the control output(s) for each controller based on 
        the current FMU state and applies the outputs to the model.
        &#39;&#39;&#39;
        for controller in self.controllers: 
            fmu_state_dict_modified = controller.control(fmu_state_dict=fmu_state_dict, curr_time=curr_time)
            #limit the controller outputs to the intersection of configured controller output variables and 
            # actually returned variables by the controller
            controller_output_keys=set(fmu_state_dict_modified) &amp; set(controller.parameters_u) 
            #multiple output controller
            controller_output={key:fmu_state_dict_modified[key] for key in controller_output_keys}  
            self.fmu_wrapper.alter_in_fmu(controller_output)</code></pre>
</details>
<div class="desc"><p>This class provides functions to handle:</p>
<ul>
<li>Controller configuration</li>
<li>Decision-making regarding whether a control action should be performed at the current time step</li>
<li>Information gathering about the variables needed from the FMU for the control actions</li>
<li>The control actions themselves</li>
</ul>
<p>The controller wrapper object acts as an interface between the controller classes and the simulation loop.</p></div>
<h3>Methods</h3>
<dl>
<dt id="src.controllers.controller_wrapper.ControllerWrapper.configure_controllers"><code class="name flex">
<span>def <span class="ident">configure_controllers</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def configure_controllers(self):
    &#39;&#39;&#39;
    Configure external controller instances for the current simulation series.

    This method iterates through the list of previously instantiated external 
    controller class instances and configures each one using the current 
    state of the FMU. The configuration is done by retrieving the control 
    variables specific to each controller.

    &#39;&#39;&#39;        
    for controller in self.controllers:
            controller.configure(self.fmu_wrapper.get_fmu_state_dict(controller.get_control_variables()))</code></pre>
</details>
<div class="desc"><p>Configure external controller instances for the current simulation series.</p>
<p>This method iterates through the list of previously instantiated external
controller class instances and configures each one using the current
state of the FMU. The configuration is done by retrieving the control
variables specific to each controller.</p></div>
</dd>
<dt id="src.controllers.controller_wrapper.ControllerWrapper.get_variables_to_read"><code class="name flex">
<span>def <span class="ident">get_variables_to_read</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_variables_to_read(self):
    &#39;&#39;&#39;
    Retrieve all variables from the model needed for calculating control outputs.

    This method collects and returns a list of variables required by the 
    external controllers to compute their respective control outputs.
    &#39;&#39;&#39;        
    variables_to_read = []
    for controller in self.controllers:   
        variables_to_read+=controller.get_control_variables() # Read all the controller variables when controller step is needed.
    return variables_to_read</code></pre>
</details>
<div class="desc"><p>Retrieve all variables from the model needed for calculating control outputs.</p>
<p>This method collects and returns a list of variables required by the
external controllers to compute their respective control outputs.</p></div>
</dd>
<dt id="src.controllers.controller_wrapper.ControllerWrapper.handle_control_action"><code class="name flex">
<span>def <span class="ident">handle_control_action</span></span>(<span>self, curr_time, fmu_state_dict)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def handle_control_action(self, curr_time, fmu_state_dict):
    &#39;&#39;&#39;
    Handle control action(s) by iterating through the external controllers in use, 
    calculating the control output(s) for each controller based on 
    the current FMU state and applies the outputs to the model.
    &#39;&#39;&#39;
    for controller in self.controllers: 
        fmu_state_dict_modified = controller.control(fmu_state_dict=fmu_state_dict, curr_time=curr_time)
        #limit the controller outputs to the intersection of configured controller output variables and 
        # actually returned variables by the controller
        controller_output_keys=set(fmu_state_dict_modified) &amp; set(controller.parameters_u) 
        #multiple output controller
        controller_output={key:fmu_state_dict_modified[key] for key in controller_output_keys}  
        self.fmu_wrapper.alter_in_fmu(controller_output)</code></pre>
</details>
<div class="desc"><p>Handle control action(s) by iterating through the external controllers in use,
calculating the control output(s) for each controller based on
the current FMU state and applies the outputs to the model.</p></div>
</dd>
<dt id="src.controllers.controller_wrapper.ControllerWrapper.perform_control_check"><code class="name flex">
<span>def <span class="ident">perform_control_check</span></span>(<span>self, curr_time_relative)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def perform_control_check(self, curr_time_relative):
    &#39;&#39;&#39;
    Determines if control action should be performed at the current simulation time.
    Returns a boolean indicating whether the the control action should be performed based on the elapsed simulation time and the `controller_step_size` parameter from the configuration.

    Parameters:
        curr_time_relative (float): The simulation time, elapsed since simulation start time

    Returns:
        bool: True if control action should be performed, False otherwise.
    &#39;&#39;&#39; 
    if any(self.controllers) and curr_time_relative % self.controller_step_size == 0:
        return True
    else:
        return False</code></pre>
</details>
<div class="desc"><p>Determines if control action should be performed at the current simulation time.
Returns a boolean indicating whether the the control action should be performed based on the elapsed simulation time and the <code>controller_step_size</code> parameter from the configuration.</p>
<h2 id="parameters">Parameters</h2>
<p>curr_time_relative (float): The simulation time, elapsed since simulation start time</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>bool</code></dt>
<dd>True if control action should be performed, False otherwise.</dd>
</dl></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="src.controllers" href="index.html">src.controllers</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="src.controllers.controller_wrapper.ControllerWrapper" href="#src.controllers.controller_wrapper.ControllerWrapper">ControllerWrapper</a></code></h4>
<ul class="">
<li><code><a title="src.controllers.controller_wrapper.ControllerWrapper.configure_controllers" href="#src.controllers.controller_wrapper.ControllerWrapper.configure_controllers">configure_controllers</a></code></li>
<li><code><a title="src.controllers.controller_wrapper.ControllerWrapper.get_variables_to_read" href="#src.controllers.controller_wrapper.ControllerWrapper.get_variables_to_read">get_variables_to_read</a></code></li>
<li><code><a title="src.controllers.controller_wrapper.ControllerWrapper.handle_control_action" href="#src.controllers.controller_wrapper.ControllerWrapper.handle_control_action">handle_control_action</a></code></li>
<li><code><a title="src.controllers.controller_wrapper.ControllerWrapper.perform_control_check" href="#src.controllers.controller_wrapper.ControllerWrapper.perform_control_check">perform_control_check</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
