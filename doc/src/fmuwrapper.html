<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>BuilDa.src.fmuwrapper API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>BuilDa.src.fmuwrapper</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper"><code class="flex name class">
<span>class <span class="ident">FMUWrapper</span></span>
<span>(</span><span>fmu_path: <module 'posixpath' (frozen)>, start_time)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class FMUWrapper:
    def __init__(self,
                 fmu_path: os.path,
                 start_time
                 ):
                
        self.fmu_path = fmu_path
        self.model_description = read_model_description(self.fmu_path)
        self.vrs = dict()

        # Get the parameter data from the FMU
        for variable in self.model_description.modelVariables:
            self.vrs[variable.name]={&#34;type&#34;:variable.type,&#34;reference&#34;:variable.valueReference,&#34;start&#34;:variable.start}

        #get start values from model description
        self.fmu_default_dict={k:
            float(self.vrs[k][&#34;start&#34;]) if self.vrs[k][&#34;type&#34;]==&#34;Real&#34; 
                and self.vrs[k][&#34;start&#34;]!=None else \
            str(self.vrs[k][&#34;start&#34;]) if self.vrs[k][&#34;type&#34;]==&#34;String&#34; 
                and self.vrs[k][&#34;start&#34;]!=None else \
            int(self.vrs[k][&#34;start&#34;]) if self.vrs[k][&#34;type&#34;]==&#34;Integer&#34; 
                and self.vrs[k][&#34;start&#34;]!=None  else \
            bool(self.vrs[k][&#34;start&#34;]) if self.vrs[k][&#34;type&#34;]==&#34;Boolean&#34; 
                and self.vrs[k][&#34;start&#34;]!=None  else \
            self.vrs[k][&#34;start&#34;] \
            for k in self.vrs.keys()}

        ##store start values to a json file (only use, if all start values are available!)
        #json.dump(self.fmu_default_dict, open(&#34;resources/FMUs/fmu_state_dict.json&#34;,&#34;w&#34;), indent=4, sort_keys=True)

        #fill missing start values with those from json
        self.fmu_default_dict.update({k:v for k,v in \
            json.load(open(&#34;resources/FMUs/fmu_state_dict.json&#34;,&#34;r&#34;)).items() \
            if k in self.fmu_default_dict.keys() and self.fmu_default_dict[k]==None})
        

        self.time = start_time

        self.init_FMU()


    def test_fmu_parameterizing(self, parameters:dict,b_verbose_mode=False) -&gt; int:
        &#39;&#39;&#39;
        Test if parameters were properly written to the FMU.

        This function verifies if the parameters defined in the provided dictionary
        match the values currently set in the FMU.
        Takes into account possible minor differences between float numbers in main 
        program and FMU because of precision limits, etc.
        Additionally the attributes of the involved parameters are read out from the 
        FMU and verified to be appropriate for manipulation.

        Args:
            parameters (dict): A dictionary containing parameter name:value pairs to verify on the FMU.
            b_verbose_mode (bool, optional): If set to True, the function will print messages also
                                            indicating successful parameter configurations. Defaults to False.

        Returns:
            int: The number of errors found during the parameter verification process.
        &#39;&#39;&#39;
        error_threshold=1e-9
        
        fmu_variables=read_model_description(self.fmu_path).modelVariables #Extract the FMU variables and attributes from the FMU file to verify if the attributes of a specific variable are appropriate for setting values.

        n_errors=0
        fmu_state_dict=self.get_fmu_state_dict(parameters.keys())
        for k in parameters.keys():
            fmu_value=fmu_state_dict[k]
            if type(parameters[k]) in [float,int,bool]:
                b_properly_written=abs(parameters[k]-fmu_value) &lt; error_threshold
            elif type(parameters[k]) in [str]:
                if isinstance(fmu_value,bytes): fmu_value=fmu_value.decode()
                b_properly_written=parameters[k]==fmu_value
            else: print(&#34;##not handled datatype &#34;,type(parameters[k]),&#34;parameter&#34;,k,&#34;cannot be testet.&#34;)
            if not(b_properly_written):
                print(&#34;##WARNING - MISMATCH: tried to set&#34;,k,&#34;to&#34;,parameters[k],&#34;actual value&#34;,fmu_value)
                n_errors+=1
            else:
                #check if fmu parameter attributes are appropriate for values to be set after fmu compilation
                fmu_variable=[v for v in fmu_variables if v.name==k][0]
                causality=fmu_variable.__getattribute__(&#34;causality&#34;)
                variability=fmu_variable.__getattribute__(&#34;variability&#34;)
                if causality!=&#34;parameter&#34; and (variability==&#34;tunable&#34; or variability==&#34;fixed&#34;):
                    print(&#34;##WARNING - INAPROPRIATE ATRIBUTE CAUSALITY: tried to set&#34;,k,&#34;to&#34;,parameters[k],&#34;actual value is &#34;+str(fmu_value)+&#34;, but causality is&#34;,&#34;\&#34;&#34;+causality+&#34;\&#34;&#34;,&#34;and variability is&#34;,&#34;\&#34;&#34;+variability+&#34;\&#34;.&#34;,&#34;The set parameter value probably wouldn&#39;t be used in simulation&#34;)
                    n_errors+=1
                else:
                    if b_verbose_mode:
                        print(&#34;#SUCCESSFULLY SET PARAMETER: tried to set&#34;,k,&#34;to&#34;,parameters[k],&#34;value is now&#34;,fmu_value,&#34;parameter attributes(causality:variability):&#34;,causality+&#34;:&#34;+variability)
        return n_errors

    def init_FMU(self):
        &#39;&#39;&#39;
        Instantiates and initializes the FMU object.

        This method creates an instance of the FMU2Slave using the model&#39;s GUID and other parameters, then instantiates the FMU and sets up the experiment starting from the current time.

        &#39;&#39;&#39;        
        self.fmu = FMU2Slave(
            guid=self.model_description.guid,
            unzipDirectory=self.__get_unzip_dir(),
            modelIdentifier=self.model_description.coSimulation.modelIdentifier,
            instanceName=&#39;fmu_variations&#39;
        )
        self.fmu.instantiate()
        self.fmu.setupExperiment(startTime=self.time)


    def step_FMU(self, step_size):
        &#39;&#39;&#39;
        Executes a simulation step for the FMU.

        Parameters:
        - step_size (float): The size of the time step.

        Updates the current time after executing the FMU&#39;s step.
        &#39;&#39;&#39;
        self.fmu.doStep(
            currentCommunicationPoint=self.time,
            communicationStepSize=step_size
        )
        self.time += step_size

    def  __get_unzip_dir(self):

        &#39;&#39;&#39; Private function to get the directory the fmu writes files.

        Arguments: none.

        Returns:
            the directory the fmu writes in.
        &#39;&#39;&#39;

        return extract(self.fmu_path)

    def terminate_fmu(self):

        &#39;&#39;&#39; Function to terminate the FMU and free the space.

        Arguments: none.

        Returns: none.
        &#39;&#39;&#39;
        try:
            self.fmu.terminate()
            if platform.system().lower()==&#34;linux&#34;: #currently deactivated on windows as it broke the execution in tests
                self.fmu.freeInstance() 
            shutil.rmtree(self.fmu.unzipDirectory)
        except Exception as e:
            print(&#34;FMU could not be terminated properly. Maybe no simulation was done after init step.&#34;)

    def save_state_fmu(self):
        &#39;&#39;&#39;
        Gets the current state of the FMU in serialized form, stores it in a class variable and returns it.

        This method retrieves the FMU state using `getFMUstate()` and then serializes it with `serializeFMUstate()`. The serialized state is returned for later use.
        &#39;&#39;&#39;
        self.state = self.fmu.getFMUstate()
        self.bstate = self.fmu.serializeFMUstate(state=self.state)
        return self.bstate

    def set_state_fmu(self):
        &#39;&#39;&#39;
        Sets a previously stored FMU state to the FMU.

        This method deserializes the stored state using `deSerializeFMUstate()` and sets it to the FMU with `setFMUstate()`. Raises a ValueError if no state has been loaded.

        &#39;&#39;&#39;       
        if self.bstate is None:
            raise ValueError(&#34;No state loaded. Call load_state_fmu() first.&#34;)
        
        self.state = self.fmu.deSerializeFMUstate(self.bstate)
        self.fmu.setFMUstate(self.state)

    def reset_fmu(self):
        &#39;&#39;&#39;
        Resets the FMU to its initial state.
        &#39;&#39;&#39;        
        self.fmu.reset()

    def alter_in_fmu(self, param_dict):
        &#39;&#39;&#39;
        Helper function to alter a set of parameters in the FMU given in a dict.

        Args:
            - params: Dict with the parameter to change as key and the corresponding changed value.

        Returns: None
        &#39;&#39;&#39;

        for variable, value in param_dict.items():
            if self.vrs[variable][&#34;type&#34;]==&#34;Real&#34;:
                self.fmu.setReal([self.vrs[variable][&#34;reference&#34;]],[value])
            elif self.vrs[variable][&#34;type&#34;]==&#34;String&#34;:
                self.fmu.setString([self.vrs[variable][&#34;reference&#34;]],[value])
            elif self.vrs[variable][&#34;type&#34;]==&#34;Boolean&#34;:
                self.fmu.setBoolean([self.vrs[variable][&#34;reference&#34;]],[value])
            elif self.vrs[variable][&#34;type&#34;]==&#34;Integer&#34;:
                self.fmu.setInteger([self.vrs[variable][&#34;reference&#34;]],[value])
            else:
                print(&#34;unknown type &#34;+ self.vrs[variable][&#34;type&#34;],&#34;for variable&#34;,variable)
    
    
    def get_fmu_state_dict(self, variables_to_read):
        &#39;&#39;&#39;
        Helper function to read parameters of the FMU and return it with the respective values in a dict.

        Args: 
            - variables_to_read: The variables that need to be read from the FMU.
                    if variables_to_read==&#34;all&#34; read out all fmu variables

        Returns: Dict with the current FMU state (minimal).
        &#39;&#39;&#39;
        
        state_dict = dict()
        if type(variables_to_read) is str and variables_to_read.lower()==&#34;all&#34;.lower(): 
            variables_to_read=self.vrs.keys()
        for variable in variables_to_read:
            try:
                if self.vrs[variable][&#34;type&#34;]==&#34;Real&#34;:
                    value=self.fmu.getReal([self.vrs[variable][&#34;reference&#34;]])[0]
                elif self.vrs[variable][&#34;type&#34;]==&#34;String&#34;:
                    value=self.fmu.getString([self.vrs[variable][&#34;reference&#34;]])[0]
                elif self.vrs[variable][&#34;type&#34;]==&#34;Boolean&#34;:
                    value=self.fmu.getBoolean([self.vrs[variable][&#34;reference&#34;]])[0]
                elif self.vrs[variable][&#34;type&#34;]==&#34;Integer&#34;:
                    value=self.fmu.getInteger([self.vrs[variable][&#34;reference&#34;]])[0]
                elif self.vrs[variable][&#34;type&#34;]==&#34;Enumeration&#34;: #apparently can be read out as float
                    value=self.fmu.getReal([self.vrs[variable][&#34;reference&#34;]])[0] #enumeration-variable readout
                else:
                    print(&#34;unknown type &#34;+ self.vrs[variable][&#34;type&#34;],&#34;for variable&#34;,variable)
                    continue
                state_dict[variable]=value
            except(KeyError): #triggers when a variable should be read out that doesn&#39;t exist in the fmu&#39;s parameter set
                print(&#34;##ignoring variable&#34;,variable,&#34;as it isn&#39;t in the fmu parameter set&#34;)
                continue
        return state_dict

    def save_current_fmu_variables(self,file_name:str=None):
        &#39;&#39;&#39;
        Save all FMU variables to a file for debugging.

        Args:
            file_name (str): Optional filename; if None, a default name will be generated.

        Returns:
            str: The filename.
        &#39;&#39;&#39;
        fmu_state_dict=self.get_fmu_state_dict(variables_to_read=&#34;all&#34;)

        if not(file_name): file_name=&#34;current_fmu_state.csv&#34;
        df=pd.DataFrame(data={&#34;value at t=&#34;+str(self.time):fmu_state_dict.values()},index=fmu_state_dict.keys()).sort_index(axis=0)

        pd.concat([df],axis=1).to_csv(file_name,sep=&#34;,&#34;)
        return file_name</code></pre>
</details>
<div class="desc"></div>
<h3>Methods</h3>
<dl>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.alter_in_fmu"><code class="name flex">
<span>def <span class="ident">alter_in_fmu</span></span>(<span>self, param_dict)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def alter_in_fmu(self, param_dict):
    &#39;&#39;&#39;
    Helper function to alter a set of parameters in the FMU given in a dict.

    Args:
        - params: Dict with the parameter to change as key and the corresponding changed value.

    Returns: None
    &#39;&#39;&#39;

    for variable, value in param_dict.items():
        if self.vrs[variable][&#34;type&#34;]==&#34;Real&#34;:
            self.fmu.setReal([self.vrs[variable][&#34;reference&#34;]],[value])
        elif self.vrs[variable][&#34;type&#34;]==&#34;String&#34;:
            self.fmu.setString([self.vrs[variable][&#34;reference&#34;]],[value])
        elif self.vrs[variable][&#34;type&#34;]==&#34;Boolean&#34;:
            self.fmu.setBoolean([self.vrs[variable][&#34;reference&#34;]],[value])
        elif self.vrs[variable][&#34;type&#34;]==&#34;Integer&#34;:
            self.fmu.setInteger([self.vrs[variable][&#34;reference&#34;]],[value])
        else:
            print(&#34;unknown type &#34;+ self.vrs[variable][&#34;type&#34;],&#34;for variable&#34;,variable)</code></pre>
</details>
<div class="desc"><p>Helper function to alter a set of parameters in the FMU given in a dict.</p>
<h2 id="args">Args</h2>
<ul>
<li>params: Dict with the parameter to change as key and the corresponding changed value.
Returns: None</li>
</ul></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.get_fmu_state_dict"><code class="name flex">
<span>def <span class="ident">get_fmu_state_dict</span></span>(<span>self, variables_to_read)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_fmu_state_dict(self, variables_to_read):
    &#39;&#39;&#39;
    Helper function to read parameters of the FMU and return it with the respective values in a dict.

    Args: 
        - variables_to_read: The variables that need to be read from the FMU.
                if variables_to_read==&#34;all&#34; read out all fmu variables

    Returns: Dict with the current FMU state (minimal).
    &#39;&#39;&#39;
    
    state_dict = dict()
    if type(variables_to_read) is str and variables_to_read.lower()==&#34;all&#34;.lower(): 
        variables_to_read=self.vrs.keys()
    for variable in variables_to_read:
        try:
            if self.vrs[variable][&#34;type&#34;]==&#34;Real&#34;:
                value=self.fmu.getReal([self.vrs[variable][&#34;reference&#34;]])[0]
            elif self.vrs[variable][&#34;type&#34;]==&#34;String&#34;:
                value=self.fmu.getString([self.vrs[variable][&#34;reference&#34;]])[0]
            elif self.vrs[variable][&#34;type&#34;]==&#34;Boolean&#34;:
                value=self.fmu.getBoolean([self.vrs[variable][&#34;reference&#34;]])[0]
            elif self.vrs[variable][&#34;type&#34;]==&#34;Integer&#34;:
                value=self.fmu.getInteger([self.vrs[variable][&#34;reference&#34;]])[0]
            elif self.vrs[variable][&#34;type&#34;]==&#34;Enumeration&#34;: #apparently can be read out as float
                value=self.fmu.getReal([self.vrs[variable][&#34;reference&#34;]])[0] #enumeration-variable readout
            else:
                print(&#34;unknown type &#34;+ self.vrs[variable][&#34;type&#34;],&#34;for variable&#34;,variable)
                continue
            state_dict[variable]=value
        except(KeyError): #triggers when a variable should be read out that doesn&#39;t exist in the fmu&#39;s parameter set
            print(&#34;##ignoring variable&#34;,variable,&#34;as it isn&#39;t in the fmu parameter set&#34;)
            continue
    return state_dict</code></pre>
</details>
<div class="desc"><p>Helper function to read parameters of the FMU and return it with the respective values in a dict.</p>
<p>Args:
- variables_to_read: The variables that need to be read from the FMU.
if variables_to_read=="all" read out all fmu variables</p>
<p>Returns: Dict with the current FMU state (minimal).</p></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.init_FMU"><code class="name flex">
<span>def <span class="ident">init_FMU</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_FMU(self):
    &#39;&#39;&#39;
    Instantiates and initializes the FMU object.

    This method creates an instance of the FMU2Slave using the model&#39;s GUID and other parameters, then instantiates the FMU and sets up the experiment starting from the current time.

    &#39;&#39;&#39;        
    self.fmu = FMU2Slave(
        guid=self.model_description.guid,
        unzipDirectory=self.__get_unzip_dir(),
        modelIdentifier=self.model_description.coSimulation.modelIdentifier,
        instanceName=&#39;fmu_variations&#39;
    )
    self.fmu.instantiate()
    self.fmu.setupExperiment(startTime=self.time)</code></pre>
</details>
<div class="desc"><p>Instantiates and initializes the FMU object.</p>
<p>This method creates an instance of the FMU2Slave using the model's GUID and other parameters, then instantiates the FMU and sets up the experiment starting from the current time.</p></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.reset_fmu"><code class="name flex">
<span>def <span class="ident">reset_fmu</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reset_fmu(self):
    &#39;&#39;&#39;
    Resets the FMU to its initial state.
    &#39;&#39;&#39;        
    self.fmu.reset()</code></pre>
</details>
<div class="desc"><p>Resets the FMU to its initial state.</p></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.save_current_fmu_variables"><code class="name flex">
<span>def <span class="ident">save_current_fmu_variables</span></span>(<span>self, file_name: str = None)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_current_fmu_variables(self,file_name:str=None):
    &#39;&#39;&#39;
    Save all FMU variables to a file for debugging.

    Args:
        file_name (str): Optional filename; if None, a default name will be generated.

    Returns:
        str: The filename.
    &#39;&#39;&#39;
    fmu_state_dict=self.get_fmu_state_dict(variables_to_read=&#34;all&#34;)

    if not(file_name): file_name=&#34;current_fmu_state.csv&#34;
    df=pd.DataFrame(data={&#34;value at t=&#34;+str(self.time):fmu_state_dict.values()},index=fmu_state_dict.keys()).sort_index(axis=0)

    pd.concat([df],axis=1).to_csv(file_name,sep=&#34;,&#34;)
    return file_name</code></pre>
</details>
<div class="desc"><p>Save all FMU variables to a file for debugging.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>file_name</code></strong> :&ensp;<code>str</code></dt>
<dd>Optional filename; if None, a default name will be generated.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>The filename.</dd>
</dl></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.save_state_fmu"><code class="name flex">
<span>def <span class="ident">save_state_fmu</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_state_fmu(self):
    &#39;&#39;&#39;
    Gets the current state of the FMU in serialized form, stores it in a class variable and returns it.

    This method retrieves the FMU state using `getFMUstate()` and then serializes it with `serializeFMUstate()`. The serialized state is returned for later use.
    &#39;&#39;&#39;
    self.state = self.fmu.getFMUstate()
    self.bstate = self.fmu.serializeFMUstate(state=self.state)
    return self.bstate</code></pre>
</details>
<div class="desc"><p>Gets the current state of the FMU in serialized form, stores it in a class variable and returns it.</p>
<p>This method retrieves the FMU state using <code>getFMUstate()</code> and then serializes it with <code>serializeFMUstate()</code>. The serialized state is returned for later use.</p></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.set_state_fmu"><code class="name flex">
<span>def <span class="ident">set_state_fmu</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_state_fmu(self):
    &#39;&#39;&#39;
    Sets a previously stored FMU state to the FMU.

    This method deserializes the stored state using `deSerializeFMUstate()` and sets it to the FMU with `setFMUstate()`. Raises a ValueError if no state has been loaded.

    &#39;&#39;&#39;       
    if self.bstate is None:
        raise ValueError(&#34;No state loaded. Call load_state_fmu() first.&#34;)
    
    self.state = self.fmu.deSerializeFMUstate(self.bstate)
    self.fmu.setFMUstate(self.state)</code></pre>
</details>
<div class="desc"><p>Sets a previously stored FMU state to the FMU.</p>
<p>This method deserializes the stored state using <code>deSerializeFMUstate()</code> and sets it to the FMU with <code>setFMUstate()</code>. Raises a ValueError if no state has been loaded.</p></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.step_FMU"><code class="name flex">
<span>def <span class="ident">step_FMU</span></span>(<span>self, step_size)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def step_FMU(self, step_size):
    &#39;&#39;&#39;
    Executes a simulation step for the FMU.

    Parameters:
    - step_size (float): The size of the time step.

    Updates the current time after executing the FMU&#39;s step.
    &#39;&#39;&#39;
    self.fmu.doStep(
        currentCommunicationPoint=self.time,
        communicationStepSize=step_size
    )
    self.time += step_size</code></pre>
</details>
<div class="desc"><p>Executes a simulation step for the FMU.</p>
<p>Parameters:
- step_size (float): The size of the time step.</p>
<p>Updates the current time after executing the FMU's step.</p></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.terminate_fmu"><code class="name flex">
<span>def <span class="ident">terminate_fmu</span></span>(<span>self)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def terminate_fmu(self):

    &#39;&#39;&#39; Function to terminate the FMU and free the space.

    Arguments: none.

    Returns: none.
    &#39;&#39;&#39;
    try:
        self.fmu.terminate()
        if platform.system().lower()==&#34;linux&#34;: #currently deactivated on windows as it broke the execution in tests
            self.fmu.freeInstance() 
        shutil.rmtree(self.fmu.unzipDirectory)
    except Exception as e:
        print(&#34;FMU could not be terminated properly. Maybe no simulation was done after init step.&#34;)</code></pre>
</details>
<div class="desc"><p>Function to terminate the FMU and free the space.</p>
<p>Arguments: none.</p>
<p>Returns: none.</p></div>
</dd>
<dt id="BuilDa.src.fmuwrapper.FMUWrapper.test_fmu_parameterizing"><code class="name flex">
<span>def <span class="ident">test_fmu_parameterizing</span></span>(<span>self, parameters: dict, b_verbose_mode=False) ‑> int</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_fmu_parameterizing(self, parameters:dict,b_verbose_mode=False) -&gt; int:
    &#39;&#39;&#39;
    Test if parameters were properly written to the FMU.

    This function verifies if the parameters defined in the provided dictionary
    match the values currently set in the FMU.
    Takes into account possible minor differences between float numbers in main 
    program and FMU because of precision limits, etc.
    Additionally the attributes of the involved parameters are read out from the 
    FMU and verified to be appropriate for manipulation.

    Args:
        parameters (dict): A dictionary containing parameter name:value pairs to verify on the FMU.
        b_verbose_mode (bool, optional): If set to True, the function will print messages also
                                        indicating successful parameter configurations. Defaults to False.

    Returns:
        int: The number of errors found during the parameter verification process.
    &#39;&#39;&#39;
    error_threshold=1e-9
    
    fmu_variables=read_model_description(self.fmu_path).modelVariables #Extract the FMU variables and attributes from the FMU file to verify if the attributes of a specific variable are appropriate for setting values.

    n_errors=0
    fmu_state_dict=self.get_fmu_state_dict(parameters.keys())
    for k in parameters.keys():
        fmu_value=fmu_state_dict[k]
        if type(parameters[k]) in [float,int,bool]:
            b_properly_written=abs(parameters[k]-fmu_value) &lt; error_threshold
        elif type(parameters[k]) in [str]:
            if isinstance(fmu_value,bytes): fmu_value=fmu_value.decode()
            b_properly_written=parameters[k]==fmu_value
        else: print(&#34;##not handled datatype &#34;,type(parameters[k]),&#34;parameter&#34;,k,&#34;cannot be testet.&#34;)
        if not(b_properly_written):
            print(&#34;##WARNING - MISMATCH: tried to set&#34;,k,&#34;to&#34;,parameters[k],&#34;actual value&#34;,fmu_value)
            n_errors+=1
        else:
            #check if fmu parameter attributes are appropriate for values to be set after fmu compilation
            fmu_variable=[v for v in fmu_variables if v.name==k][0]
            causality=fmu_variable.__getattribute__(&#34;causality&#34;)
            variability=fmu_variable.__getattribute__(&#34;variability&#34;)
            if causality!=&#34;parameter&#34; and (variability==&#34;tunable&#34; or variability==&#34;fixed&#34;):
                print(&#34;##WARNING - INAPROPRIATE ATRIBUTE CAUSALITY: tried to set&#34;,k,&#34;to&#34;,parameters[k],&#34;actual value is &#34;+str(fmu_value)+&#34;, but causality is&#34;,&#34;\&#34;&#34;+causality+&#34;\&#34;&#34;,&#34;and variability is&#34;,&#34;\&#34;&#34;+variability+&#34;\&#34;.&#34;,&#34;The set parameter value probably wouldn&#39;t be used in simulation&#34;)
                n_errors+=1
            else:
                if b_verbose_mode:
                    print(&#34;#SUCCESSFULLY SET PARAMETER: tried to set&#34;,k,&#34;to&#34;,parameters[k],&#34;value is now&#34;,fmu_value,&#34;parameter attributes(causality:variability):&#34;,causality+&#34;:&#34;+variability)
    return n_errors</code></pre>
</details>
<div class="desc"><p>Test if parameters were properly written to the FMU.</p>
<p>This function verifies if the parameters defined in the provided dictionary
match the values currently set in the FMU.
Takes into account possible minor differences between float numbers in main
program and FMU because of precision limits, etc.
Additionally the attributes of the involved parameters are read out from the
FMU and verified to be appropriate for manipulation.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>parameters</code></strong> :&ensp;<code>dict</code></dt>
<dd>A dictionary containing parameter name:value pairs to verify on the FMU.</dd>
<dt><strong><code>b_verbose_mode</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>If set to True, the function will print messages also
indicating successful parameter configurations. Defaults to False.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>int</code></dt>
<dd>The number of errors found during the parameter verification process.</dd>
</dl></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="BuilDa.src" href="index.html">BuilDa.src</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="BuilDa.src.fmuwrapper.FMUWrapper" href="#BuilDa.src.fmuwrapper.FMUWrapper">FMUWrapper</a></code></h4>
<ul class="">
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.alter_in_fmu" href="#BuilDa.src.fmuwrapper.FMUWrapper.alter_in_fmu">alter_in_fmu</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.get_fmu_state_dict" href="#BuilDa.src.fmuwrapper.FMUWrapper.get_fmu_state_dict">get_fmu_state_dict</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.init_FMU" href="#BuilDa.src.fmuwrapper.FMUWrapper.init_FMU">init_FMU</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.reset_fmu" href="#BuilDa.src.fmuwrapper.FMUWrapper.reset_fmu">reset_fmu</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.save_current_fmu_variables" href="#BuilDa.src.fmuwrapper.FMUWrapper.save_current_fmu_variables">save_current_fmu_variables</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.save_state_fmu" href="#BuilDa.src.fmuwrapper.FMUWrapper.save_state_fmu">save_state_fmu</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.set_state_fmu" href="#BuilDa.src.fmuwrapper.FMUWrapper.set_state_fmu">set_state_fmu</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.step_FMU" href="#BuilDa.src.fmuwrapper.FMUWrapper.step_FMU">step_FMU</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.terminate_fmu" href="#BuilDa.src.fmuwrapper.FMUWrapper.terminate_fmu">terminate_fmu</a></code></li>
<li><code><a title="BuilDa.src.fmuwrapper.FMUWrapper.test_fmu_parameterizing" href="#BuilDa.src.fmuwrapper.FMUWrapper.test_fmu_parameterizing">test_fmu_parameterizing</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
